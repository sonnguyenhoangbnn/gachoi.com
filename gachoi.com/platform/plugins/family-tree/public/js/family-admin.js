$(document).ready((function(){function e(){0==$("#gender_id").val()?($("#main-family-tree .wife").removeClass("show").addClass("hide"),$("#main-family-tree .husband").removeClass("hide").addClass("show")):($("#main-family-tree .wife").removeClass("hide").addClass("show"),$("#main-family-tree .husband").removeClass("show").addClass("hide")),$.ajax({url:$(".family-child-cancel").data("target"),type:"GET",success:function(e){if(e.error)Botble.showError(e.message);else{$("#main-family-tree-child .list-group .list-group-item:not(:last-child)").remove(),$("#main-family-tree-siblings .list-group li").remove();var a=$(document).find("#family_tree_child_template").html();e.children.forEach((function(e){var t=a.replace(/__image__/gi,e.image).replace(/__name__/gi,e.name).replace(/__id__/gi,e.id).replace(/__gender__/gi,e.gender);$("#main-family-tree-child .list-group li:eq(0)").before(t)})),e.siblings.forEach((function(e){var t=a.replace(/__image__/gi,e.image).replace(/__name__/gi,e.name).replace(/__id__/gi,e.id).replace(/__gender__/gi,e.gender);$("#main-family-tree-siblings .list-group").append(t)}))}},error:function(e){Botble.handleError(e)}})}$(".setFamily").on("click",(function(e){var a=$(this).closest(".family-group").find(".family-choose");"single"===$(this).closest(".family-group").find(".next-input").data("type")?$(this).closest(".family-option").hide():$(this).hide(),a.show()})),$(".family-cancel").on("click",(function(e){var a=$(this).closest(".family-choose"),t=$(this).closest(".family-group").find(".family-option");"single"!==$(this).closest(".family-group").find(".next-input").data("type")&&$(this).closest(".family-group").find(".setFamily").show(),a.hide(),t.show()})),$(document).on("click","body",(function(e){var a=$(".box-family-tree-search-advance");a.is(e.target)||0!==a.has(e.target).length||a.find(".panel").addClass("hidden")})),$(document).on("click",".list-family-tree-search-data .selectable-item",(function(e){e.preventDefault();var a=$(e.currentTarget),t=a.closest(".form-group").find("input[type=hidden]"),r=a.closest(".box-family-tree-search-advance").find(".textbox-family-tree-advancesearch"),l=a.closest(".family-group").find(".selected");t.val(a.data("id"));var i={};i[t.attr("name")]=a.data("id");var o=$(document).find("#selected_family_tree_product_list_template").html().replace(/__name__/gi,a.data("name")).replace(/__id__/gi,a.data("id")).replace(/__url__/gi,a.data("url")).replace(/__image__/gi,a.data("image")).replace(/__attributes__/gi,a.find("a span").text()),n=a.closest(".family-group").find(".family-choose"),s=a.closest(".family-group").find(".family-option");$.ajax({url:a.closest(".list-family-tree-search-data").data("target"),data:i,type:"POST",success:function(e){if(void 0!==e.error&&e.error){var t=a.closest(".box-family-tree-search-advance").find(".panel");t.removeClass("hidden"),t.addClass("active"),Botble.blockUI({target:t,iconOnly:!0,overlayColor:"none"}),Botble.showError(e.message),Botble.unblockUI(t)}else"single"===r.data("type")?(n.hide(),l.html(o)):l.append(o),s.show()},error:function(e){}}),a.closest(".panel").addClass("hidden")})),$(document).on("click",".list-family-tree-search-data .selectable-couple-item",(function(e){e.preventDefault();var a=$(e.currentTarget),t=a.closest(".form-group").find("input[type=hidden]"),r=a.closest(".box-family-tree-search-advance").find(".textbox-family-tree-advancesearch"),l=a.closest(".family-group").find(".selected");if("couple"===r.data("type")){t.val(a.data("id"));var i={};i[t.attr("name")]=a.data("id");var o=$(document).find("#selected_family_tree_couple_product_list_template").html().replace(/__husband_name__/gi,a.data("husband-name")).replace(/__wife_name__/gi,a.data("wife-name")).replace(/__id__/gi,a.data("id")).replace(/__husband_url__/gi,a.data("husband-url")).replace(/__wife_url__/gi,a.data("wife-url")).replace(/__husband_image__/gi,a.data("husband-image")).replace(/__wife_image__/gi,a.data("wife-image")).replace(/__husband_attributes__/gi,a.find("a span").text()).replace(/__wife_attributes__/gi,a.find("a span").text());$.ajax({url:a.closest(".list-family-tree-search-data").data("target"),data:i,type:"POST",success:function(e){if(void 0!==e.error&&e.error){var t=a.closest(".box-family-tree-search-advance").find(".panel");t.removeClass("hidden"),t.addClass("active"),Botble.blockUI({target:t,iconOnly:!0,overlayColor:"none"}),Botble.showError(e.message),Botble.unblockUI(t)}else{l.html(o);var r=a.closest(".family-group").find(".family-choose"),i=a.closest(".family-group").find(".family-option");r.hide(),i.show()}},error:function(e){}})}else{var n=t.val().split(",");if($.each(n,(function(e,a){n[e]=parseInt(a)})),$.inArray(a.data("id"),n)<0){t.val()?t.val(t.val()+","+a.data("id")):t.val(a.data("id"));var s=$(document).find("#selected_product_list_template").html().replace(/__name__/gi,a.data("name")).replace(/__id__/gi,a.data("id")).replace(/__url__/gi,a.data("url")).replace(/__image__/gi,a.data("image")).replace(/__attributes__/gi,a.find("a span").text());a.closest(".form-group").find(".list-selected-products").removeClass("hidden"),a.closest(".form-group").find(".list-selected-products table tbody").append(s)}}a.closest(".panel").addClass("hidden")})),$(document).on("click",".textbox-family-tree-advancesearch",(function(e){var a=$(e.currentTarget),t=a.closest(".box-family-tree-search-advance").find(".panel");t.removeClass("hidden"),t.addClass("active"),0===t.find(".panel-body").length&&(Botble.blockUI({target:t,iconOnly:!0,overlayColor:"none"}),$.ajax({url:a.data("target"),type:"GET",success:function(e){e.error?Botble.showError(e.message):(t.html(e.data),Botble.unblockUI(t))},error:function(e){Botble.handleError(e),Botble.unblockUI(t)}}))})),$(document).on("keyup",".textbox-family-tree-advancesearch",(function(e){var a=$(e.currentTarget),t=a.closest(".box-family-tree-search-advance").find(".panel");setTimeout((function(){Botble.blockUI({target:t,iconOnly:!0,overlayColor:"none"}),$.ajax({url:a.data("target")+"&keyword="+a.val(),type:"GET",success:function(e){e.error?Botble.showError(e.message):(t.html(e.data),Botble.unblockUI(t))},error:function(e){Botble.handleError(e),Botble.unblockUI(t)}})}),500)})),$(document).on("click",".box-family-tree-search-advance .page-link",(function(e){e.preventDefault();var a=$(e.currentTarget);if(!a.closest(".page-item").hasClass("disabled")&&a.prop("href")){var t=a.closest(".box-family-tree-search-advance").find(".panel");Botble.blockUI({target:t,iconOnly:!0,overlayColor:"none"}),$.ajax({url:a.prop("href")+"&keyword="+a.val(),type:"GET",success:function(e){e.error?Botble.showError(e.message):(t.html(e.data),Botble.unblockUI(t))},error:function(e){Botble.handleError(e),Botble.unblockUI(t)}})}})),$("#gender_id").on("change",(function(a){$.ajax({url:a.target.getAttribute("data-target"),data:{gender_id:a.target.value},type:"POST",success:function(a){a.error?Botble.showError(a.message):e()},error:function(e){Botble.handleError(e)}})})),$(document).on("click",".submit-add-child",(function(a){a.preventDefault();var t=$("input[name=add_child_name]").val(),r=$("input[name=add_child_gender]:checked").val(),l=$("input[name=add_child_parent]").val(),i=$(a.currentTarget);""===t?$("input[name=add_child_name]").closest(".form-group").addClass("has-error"):$("input[name=add_child_name]").closest(".form-group").removeClass("has-error"),void 0===r?$("input[name=add_child_gender]").closest(".form-group").addClass("has-error"):$("input[name=add_child_gender]").closest(".form-group").removeClass("has-error"),""!==t&&void 0!==r&&$.ajax({url:i.data("target"),data:{name:t,gender:r,parent:l},type:"POST",success:function(a){a.error?Botble.showError(a.message):e()},error:function(e){Botble.handleError(e)}})})),$(document).on("click",".btn-add-child",(function(e){e.preventDefault(),$(".form-child").show()})),$(document).on("click",".family-child-cancel",(function(e){e.preventDefault(),$(".form-child").hide()}))}));
